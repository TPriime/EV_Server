{"version":3,"sources":["../../src/controllers/userController.js"],"names":["config","db","api","post","req","res","files","status","json","message","mediaFile","userProfilePicture","User","findOne","cardID","body","existingCardID","userEmail","existingUserEmail","phoneNumber","existingUserphone","data","firstName","lastName","otherNames","dateOfBirth","gender","state","lga","town","maritalStatus","occupation","fingerprint","JSON","stringify","userProfilePictureId","upload","create","console","log","get","find","users","length","error","id","params","q","result","query","$regex","RegExp","__v","r","p","$or","user","put","findByIdAndUpdate","delete","findByIdAndDelete"],"mappings":"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","file":"userController.js","sourcesContent":["import { Router } from 'express';\nimport User from '../models/userModel';\nimport { validateToken } from '../middleware/accessToken';\n\nexport default ({ config, db}) => {\n    let api = Router();\n\n    // 'evoting_api/v1/users/register' Endpoint to create a new user\n    api.post('/register', async (req, res) => {\n        validateToken(req, res);\n\n        if (!req.files) return res.status(400).json({message: \"No files were uploaded\"});\n\n        let mediaFile = req.files.userProfilePicture;\n\n        try {\n            let existingCardID = await User.findOne({cardID: req.body.cardID});\n            if(existingCardID) return res.status(400).json({message: 'cardID already in use'});\n\n            let existingUserEmail = await User.findOne({userEmail: req.body.userEmail});\n            if(existingUserEmail) return res.status(400).json({message: 'Email already in use'});\n\n            let existingUserphone = await User.findOne({phoneNumber: req.body.phoneNumber});\n            if (existingUserphone) return res.status(400).json({message: 'Phone number already in use'});\n\n            const data = {\n                cardID: req.body.cardID,\n                firstName: req.body.firstName,\n                lastName: req.body.lastName,\n                otherNames: req.body.otherNames,\n                phoneNumber: req.body.phoneNumber,\n                dateOfBirth: req.body.dateOfBirth,\n                gender: req.body.gender,\n                state: req.body.state,\n                lga: req.body.lga,\n                town: req.body.town,\n                maritalStatus: req.body.maritalStatus,\n                occupation: req.body.occupation,\n                userEmail: req.body.userEmail,\n                fingerprint: req.body.fingerprint,\n                userProfilePicture: JSON.stringify(mediaFile.data),\n                userProfilePictureId: \" \"\n            }\n\n            let upload;\n            try {\n                upload = await User.create(data);\n            } catch(err){\n                return res.status(401).json({message: \"Registration was not successful\"});\n            }\n\n            res.json({message: 'Registration done.', upload});\n\n        } catch (error) {\n            console.log(error);\n            res.status(422).json(error);\n        }\n    });\n\n    // 'evoting_api/v1/users' Endpoint to see all users, admin only\n    api.get('/', async (req, res)=> {\n\n        validateToken(req, res);\n\n        try {\n            let users = await User.find();\n\n            if (users.length === 0) return res.status(401).json({message: \"No user found\"});\n            res.json(users);\n        } catch (error) {\n            res.status(422).json({error: error});\n        }\n    });\n\n    // 'evoting_api/v1/users/id' Endpoint to get a user and search user included!!!\n    api.get('/:id', async (req, res)=> {\n\n        const id = req.params.id;\n        if (req.params.id === 'search') { // '/evoting_api/v1/users/search' Endpoint to get a User in the database\n            let q, result;\n            try {\n                if (req.query.userEmail) {\n                    q = req.query.userEmail;\n                    result = await User.find({\n                        userEmail: {\n                            $regex: new RegExp(q,'i')\n                        }},{\n                            __v: 0\n                        });\n                }else if (req.query.firstName) {\n                    q = req.query.firstName;\n                    result = await User.find({\n                        firstName: {\n                            $regex: new RegExp(q,'i')\n                        }},{\n                            __v: 0\n                        });\n                }else if (req.query.lastName) {\n                    q = req.query.lastName;\n                    result = await User.find({\n                        lastName: {\n                            $regex: new RegExp(q,'i')\n                        }},{\n                            __v: 0\n                        });\n                }else if (req.query.lastName && req.query.userEmail && req.query.firstName) {\n                    q = req.query.firstName;\n                    r = req.query.lastName;\n                    p = req.query.userEmail;\n                    result = await User.find({\n                        $or: [\n                            {firstName:{$regex: new RegExp(q,'i')}},\n                            {lastName:{$regex: new RegExp(r,'i')}},\n                            {userEmail:{$regex: new RegExp(p,'i')}}\n                        ]\n                    },{\n                        __v: 0\n                    });\n                }\n                if(result.length === 0) res.status(401).json({message: \"No user found\"});\n                res.json(result);\n            } catch (error) {\n                res.status(417).json({ message: \"Could not find any User                                                                                                                    \"});\n            }\n        }else{\n            try {\n                let user = await User.findOne({cardID: id},{__v: 0});\n\n                if (!user) return res.status(401).json({message: \"No user found\"});\n\n                res.json(user);\n            } catch (error) {\n                res.status(422).json({error: \"The error\"});\n            }\n        }\n    });\n\n    // 'evoting_api/v1/users/update/:id' Endpoint to update any user parameters\n    api.put('/update/:id', async (req, res) => {\n        validateToken(req, res);\n        const id = req.params.id;\n        const {firstName,lastName,otherNames,dateOfBirth,gender,state,lga,town,maritalStatus,occupation} = req.body;\n\n        try {\n            let user = await User.findByIdAndUpdate(id, {firstName,lastName,otherNames,dateOfBirth,gender,state,lga,town,maritalStatus,occupation});\n            if (!user) return res.status(401).json({message: \"No user found\"});\n            res.json({message: 'Update successful'});\n        } catch (error){\n            res.status(422).json({error: error});\n        }\n    });\n\n    // 'evoting_api/v1/users/delete/:id' Endpoint to delete any user\n    api.delete('/delete/:id', async (req, res) => {\n\n        validateToken(req, res);\n\n        const id = req.params.id;\n        try {\n            let user = await User.findByIdAndDelete(id);\n            if (!user) return res.status(401).json({message: \"No user found\"});\n            res.json({message: 'User account deleted successfully'});\n\n        } catch (error) {\n            res.status(422).json({error: error});\n        }\n    });\n\n    return api;\n}"]}